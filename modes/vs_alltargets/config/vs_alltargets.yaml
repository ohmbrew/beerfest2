#config_version=5
##! mode: vs_alltargets

# vs_alltargets is a VS mode that pits opponent vs USA: object, hit any target to reduce opponent hit pts. If player HP gets to 0 before opponent's, you lose.
# vs_alltargets is started because one of the following occurred:
# 1. Player has not filled up mug (i.e. game theme mode not enabled) and has hit rimrules/mode saucers
#    a. 50% of the time, vs will start. Other 50% of the time, old original audio callout and popout will happen
# 2. Player has filled up mug (i.e. game theme mode is enabled) and has hit rimrules/mode saucers
#    a. 50% of the time, vs will start. Other 50% of the time, game theme mode will start
# POSSIBLE CHALLENGES
# 1. VIDEO. Use flippers to move a cup left/right to catch falling ping pong balls
# 2. VIDEO. Use flippers to balance a drunk walking dude like in that Boobietron game for some amount of time
# 3. Flippers are flopped for some amount of time (30 secs?). If player succeeds, they "win" that country
# 4. Have a slide show meters of USA and opponent. All shots increase USA meter. Opp meter rises at some rate. First to top "wins"!
# 5. Go down inlanes some # of times within some amount of time
# 6. Hit slings some number of times within some amount of time
# 7. Insta-kill! Chug?
# Note: when copying, must update:
#  - mode start_events
#  - mode stop_events
#  - player_health_drain restart event
#  - slide names in slides:
#  - slide names in slide_player:
#  - variable_player
#  - base mode vs_alltargets_stopped: to update country insert
#  - shows: update show name
#  - show_player: update show names
#  - event player: choose random opponent
#  - update Field.yaml to include new VS challenge
#  - add eject from saucers if applicable

mode:
  start_events: start_mode_vs_alltargets
  stop_events: game_ended, stop_mode_vs_alltargets, start_mode_bonusv2
  events_when_started: mode_type_mission_started
  events_when_stopped: mode_type_mission_stopped

timers:
  opponent_health_update:   # ensure that health meter gets update *after* we update opponent health player variable
    start_value: 1
    end_value: 0
    direction: down
    tick_interval: .1s
    restart_on_complete: false
    control_events:
      - action: restart
        event: dec_opponent_health
      - action: stop
        event: stop_update_timers
  player_health_update:    # ensure that player health meter gets update *after* we update player health player variable
    start_value: 1
    end_value: 0
    direction: down
    tick_interval: .1s
    restart_on_complete: false
    control_events:
      - action: restart
        event: dec_player_health
      - action: stop
        event: stop_update_timers
  player_health_drain:    # start at 75 TODO: That's 1 shot to make every 5 secs to beat player. Is that hard enough?
    start_value: 15
    end_value: 0
    direction: down
    restart_on_complete: false
    tick_interval: 3s     # that's 1 shot every 3 secs for player to beat opponent. TODO: IDK, what's been feedback after expos?
    control_events:
      - action: restart
        event: slide_vs_alltargets_intro_removed
      - action: stop
        event: vs_result_win
      - action: stop
        event: stop_update_timers
  update_vs_pos:
    start_value: 1
    end_value: 0
    direction: down
    tick_interval: 1s
    control_events:
      - action: restart
        event: slide_vs_alltargets_intro_active
      - action: restart
        event: slide_vs_alltargets_win_active
      - action: restart
        event: slide_vs_alltargets_lose_active  

random_event_player:
  select_rnd_vs_alltargets_kicker_action:
    force_all: false
    force_different: false
    events:
      rnd_vs_alltargets_kicker_action_result_instachug: 10
      play_betterwhendrunk_and_eject_vs: 90

# counter counts targets hit against opponent. If it gets to 0 before player health does, then player wins VS mode
counters:
  count_opponent_hits:
    direction: down
    starting_count: 15

    count_events: >
      shot_pop_lower_hit, shot_pop_upper_right_hit, shot_pop_upper_left_hit,
      shot_chance_hit, shot_special_hit,
      shot_take_hit_hit, shot_chug_beer_hit, shot_do_shot_hit, shot_quarters_hit,
      shot_tgt_ramp_boot_left_hit, shot_tgt_ramp_boot_right_hit, shot_tavern_hit,
      shot_diverter_hit, shot_ramp_upf_hit, shot_tgt_rimrules_hit, shot_popo_released_hit, shot_upf_tgt_left_hit, shot_upf_tgt_right_hit,
      shot_horseshoe_hit
    count_complete_value: 0
    events_when_hit: dec_opponent_health
    reset_events: vs_reset  
    events_when_complete: vs_result_win
    reset_on_complete: false

event_player:
  timer_opponent_health_update_complete:
    update_opponent_health:
      new_width: {value: current_player.opponent_health}
  timer_player_health_update_complete:
    update_player_health:
      new_width: {value: current_player.player_health}
  timer_player_health_drain_tick:
    dec_player_health
  timer_player_health_drain_complete:
    vs_result_lose
  slide_vs_alltargets_win_removed:
    stop_mode_vs_alltargets
  slide_vs_alltargets_lose_removed:
    stop_mode_vs_alltargets
  slide_vs_alltargets_intro_removed{device.switches.s_kicker_rimrules.state==1}: kicker_rimrules_eject
  slide_vs_alltargets_intro_removed{device.switches.s_kicker_mode.state==1}: kicker_mode_eject
  shot_kicker_mode_hit: select_rnd_vs_alltargets_kicker_action
  rnd_vs_alltargets_kicker_action_result_instachug:
    - stop_update_timers
    - vs_reset
  slide_vs_alltargets_instachug_removed:
    vs_result_win
  timer_update_vs_pos_complete{current_player.opponent == "CANADA"}:
    adjust_vs:
      new_x: 550
      type: int
  timer_update_vs_pos_complete{current_player.opponent == "SCOTLAND"}:
    adjust_vs:
      new_x: 483
      type: int
  timer_update_vs_pos_complete{current_player.opponent == "IRELAND"}:
    adjust_vs:
      new_x: 550
      type: int
  timer_update_vs_pos_complete{current_player.opponent == "TOBAGO"}:
    adjust_vs:
      new_x: 550
      type: int
  timer_update_vs_pos_complete{current_player.opponent == "GERMANY"}:
    adjust_vs:
      new_x: 515
      type: int

sound_player:
  slide_vs_alltargets_intro_active:
    crowd:
      loops: -1
    introrepeat:
      action: stop
    boom_x4:
      action: play
  slide_vs_alltargets_instachug_active:
    crowd:
      action: stop
    winner_usa:
      action: play
  vs_result_win:
    crowd:
      action: stop
    voice_vs_win:
      loops: 0
  vs_result_lose:
    crowd:
      action: stop
    voice_vs_lose:
      loops:
  mode_vs_alltargets_stopping:
    crowd:
      action: stop
  shot_kicker_rimrules_hit:
    rimrules:
      action: play
      events_when_stopped: kicker_rimrules_eject
  
  play_betterwhendrunk_and_eject_vs:
    voice_betterwhendrunk:
      action: play
      events_when_stopped: kicker_mode_eject
    

shows:
  vs_alltargets_flash_usa:
    - duration: 1
      lights:
        usa_left: (color)
        usa_right: (color)
    - duration: 1
      lights:
        usa_left: off
        usa_right: off
  vs_alltargets_flash_opponent:
    - duration: 1
      lights:
        (led_left): (color)
        (led_right): (color)
    - duration: 1
      lights:
        (led_left): off
        (led_right): off
  flash_all_blue_alltargets:
    - duration: .5s
      lights:
        playfield:
          color: 008ce5
          fade: .1s
        gi:
          color: 008ce5
          fade: .1s
    - duration: .5s
      lights:
        playfield:
          color: off
          fade: .5s
        gi:
          color: off
          fade: .5s

show_player:
  mode_vs_alltargets_started:
    vs_alltargets_flash_usa:
      loops: -1
      speed: 4
      show_tokens:
        color: yellow
    vs_alltargets_flash_opponent:
      loops: -1
      speed: 4
      show_tokens:
        led_left: (current_player.opponent_left)
        led_right: (current_player.opponent_right)
        color: yellow
  mode_vs_alltargets_stopping:
    vs_alltargets_flash_usa:
      action: stop
    vs_alltargets_flash_opponent:
      action: stop
  vs_result_win:
    vs_alltargets_flash_usa:
      loops: -1
      speed: 4
      priority: 4000
      show_tokens:
        color: green
    vs_alltargets_flash_opponent:
      loops: -1
      speed: 4
      priority: 4000
      show_tokens:
        led_left: (current_player.opponent_left)
        led_right: (current_player.opponent_right)
        color: red
  vs_result_lose:
    vs_alltargets_flash_usa:
      loops: -1
      speed: 4
      priority: 4000
      show_tokens:
        color: red
    vs_alltargets_flash_opponent:
      loops: -1
      speed: 4
      priority: 4000
      show_tokens:
        led_left: (current_player.opponent_left)
        led_right: (current_player.opponent_right)
        color: green
  timer_player_health_update_complete:            # engage shaker when we are hit
    show_shaker_half:
      loops: 0
  logicblock_count_opponent_hits_updated:         # flash all blue when we hit opponent
    flash_all_blue_alltargets:
      priority: 5000
      loops: 0

slides:
  vs_alltargets_mini:
    - type: image
      image: TextOnMini-BattleMode
      animations:
        show_slide:
          - property: opacity
            value: 1
            duration: 0.5s
            easing: in_out_quint
          - property: opacity
            value: 0
            duration: 0.5s
            repeat: true
            easing: in_out_quint
    - type: image
      image: TextOnMini-AllTargetsHitOpponent
    - type: image
      image: minibg

  vs_alltargets_intro:
    widgets:
    - type: text
      text: USA
      font_size: 25
      font_name: druillet
      anchor_x: left
      anchor_y: center
      x: left + 30
      y: middle + 200
      color: 008ce5ff
      animations:
        show_slide:
          - property: font_size
            value: 175
            duration: .5s
    - type: text
      text: vs
      font_size: 25
      font_name: druillet
      anchor_x: center
      anchor_y: center
      x: middle - 200
      y: middle + 200
      color: 008ce5ff
      opacity: 0
      animations:
        adjust_vs:
          - property: x
            value: (new_x)
            duration: 0s
          - property: opacity
            value: 1
            duration: 0
            timing: after_previous
          - property: font_size
            value: 175
            duration: .25s
            timing: with_previous
          
    - type: text
      text: (opponent)
      font_size: 25
      font_name: druillet
      anchor_x: right
      anchor_y: center
      x: right
      y: middle + 200
      color: 008ce5ff
      opacity: 0
      animations:
        show_slide:
          - property: opacity
            value: 0
            duration: 2s
          - property: opacity
            value: 1
            duration: 0
            timing: after_previous
          - property: font_size
            value: 175
            duration: .25s
            timing: with_previous
    - type: image
      image: MainText-BattleMode
      opacity: 0
      scale: .1
      animations:
        show_slide:
          - property: opacity
            value: 0
            duration: 3s
          - property: opacity
            value: 1
            duration: 0
            timing: after_previous
          - property: scale
            value: 1
            duration: .25s
            timing: with_previous        
    - type: video
      video: bubbles
  vs_alltargets_status:
    widgets:
    - type: text
      text: ALL TARGETS
      font_size: 125
      font_name: druillet
      anchor_x: middle
      anchor_y: top
      x: middle
      y: top - 50
      color: 008ce5ff
    - type: text
      text: HIT (opponent)
      font_size: 125
      font_name: druillet
      anchor_x: middle
      anchor_y: top
      x: middle
      y: top - 250
      color: 008ce5ff
    
    # player name
    - type: text
      text: USA
      font_size: 100
      font_name: druillet
      anchor_x: left
      anchor_y: bottom
      x: left + 50
      y: bottom + 175
      color: 008ce5ff

    # player health meter
    - type: rectangle
      y: bottom + 195
      x: middle - 150
      anchor_x: left
      anchor_y: bottom
      width: 750        # 50 pixel hit width * 15 hits = 750 - 15*50 = 0. So 15 hits to go to 0
      height: 75
      color: 008ce5ff
      animations:
        update_player_health:
          - property: width
            value: (new_width)

    # opponent name   
    - type: text
      text: (opponent)
      font_size: 100
      font_name: druillet
      anchor_x: left
      anchor_y: bottom
      x: left + 50
      y: bottom + 50
      color: red
    
    # opponent health
    - type: rectangle
      y: bottom + 85
      x: middle - 150
      anchor_x: left
      anchor_y: bottom
      width: 750      # start with 750 pixel wide health. # 50 pixel hit width * 15 hits = 750 - 15*50 = 0. So 15 hits to go to 0
      height: 75
      color: red
      animations:
        update_opponent_health:   # each time this event comes in (with value: set to updated opponent health), it will update the width of the health bar to new value
          - property: width
            value: (new_width)  # tracked by a counter that counts down every time one of the shots is hit (like with mug fill)
    - type: video
      video: bubbles

  vs_alltargets_instachug:
    widgets:
    - type: text
      text: INSTA CHUG
      font_size: 25
      font_name: druillet
      anchor_x: middle
      anchor_y: middle
      x: middle
      y: middle
      color: 008ce5ff
      animations:
        show_slide:
          - property: font_size
            value: 250
            duration: .5s
    - type: image
      image: background

  vs_alltargets_win:
    widgets:
    - type: text
      text: USA
      font_size: 25
      font_name: druillet
      anchor_x: left
      anchor_y: center
      x: left + 30
      y: middle + 200
      color: 008ce5ff
      animations:
        show_slide:
          - property: font_size
            value: 150
            duration: .5s
    - type: text
      text: vs
      font_size: 25
      font_name: druillet
      anchor_x: center
      anchor_y: center
      x: middle - 200
      y: middle + 200
      color: 008ce5ff
      opacity: 0
      animations:
        adjust_vs:
          - property: x
            value: (new_x)
            duration: 0s
          - property: opacity
            value: 1
            duration: 0s
            timing: after_previous
          - property: font_size
            value: 175
            duration: .25s
            timing: with_previous
    - type: text
      text: (opponent)
      font_size: 25
      font_name: druillet
      anchor_x: right
      anchor_y: center
      x: right
      y: middle + 200
      color: 008ce5ff
      opacity: 0
      animations:
        show_slide:
          - property: opacity
            value: 0
            duration: 2s
          - property: opacity
            value: 1
            duration: 0
            timing: after_previous
          - property: font_size
            value: 150
            duration: .25s
            timing: with_previous
    - type: text
      text: PLAYER WINS
      font_size: 25
      font_name: druillet
      anchor_x: center
      anchor_y: center
      x: middle
      y: middle
      color: green
      opacity: 0
      animations:
        show_slide:
          - property: opacity
            value: 0
            duration: 2.5s
          - property: opacity
            value: 1
            duration: 0
            timing: after_previous
          - property: font_size
            value: 150
            duration: .25s
            timing: with_previous
    - type: text
      text: (player|pts_vs_alltargets_win)
      number_grouping: true
      min_digits: 1
      font_name: druillet
      color: green
      font_size: 10
      anchor_x: middle
      anchor_y: middle
      x: middle
      y: middle - 200
      opacity: 0
      animations:
        show_slide:
        - property: opacity
          value: 0
          duration: 2.5s
        - property: opacity
          value: 1
          duration: 0
          timing: after_previous
        - property: font_size
          value: 150
          duration: .25s
          timing: with_previous 
    - type: video
      video: bubbles

  vs_alltargets_lose:
    widgets:
    - type: text
      text: USA
      font_size: 25
      font_name: druillet
      anchor_x: left
      anchor_y: center
      x: left + 30
      y: middle + 200
      color: 008ce5ff
      animations:
        show_slide:
          - property: font_size
            value: 150
            duration: .5s
    - type: text
      text: vs
      font_size: 25
      font_name: druillet
      anchor_x: center
      anchor_y: center
      x: middle - 200
      y: middle + 200
      color: 008ce5ff
      opacity: 0
      animations:
        adjust_vs:
          - property: x
            value: (new_x)
            duration: 0s
          - property: opacity
            value: 1
            duration: 0
            timing: after_previous
          - property: font_size
            value: 175
            duration: .25s
            timing: with_previous
    - type: text
      text: (opponent)
      font_size: 25
      font_name: druillet
      anchor_x: right
      anchor_y: center
      x: right
      y: middle + 200
      color: 008ce5ff
      opacity: 0
      animations:
        show_slide:
          - property: opacity
            value: 0
            duration: 2s
          - property: opacity
            value: 1
            duration: 0
            timing: after_previous
          - property: font_size
            value: 150
            duration: .25s
            timing: with_previous
    - type: text
      text: PLAYER LOSES
      font_size: 25
      font_name: druillet
      anchor_x: center
      anchor_y: center
      x: middle
      y: middle - 100
      color: red
      opacity: 0
      animations:
        show_slide:
          - property: opacity
            value: 0
            duration: 2.5s
          - property: opacity
            value: 1
            duration: 0
            timing: after_previous
          - property: font_size
            value: 200
            duration: .25s
            timing: with_previous       
    - type: video
      video: bubbles

slide_player:
  mode_vs_alltargets_started:
    vs_alltargets_intro:
      target: main
      priority: 4000
      expire: 5s
    vs_alltargets_mini:
      target: mini
      priority: 4000
  slide_vs_alltargets_intro_removed:
    vs_alltargets_status:
      target: main
      priority: 4000
  rnd_vs_alltargets_kicker_action_result_instachug:
    vs_alltargets_status:
      action: remove
    vs_alltargets_instachug:
      target: main
      priority: 5000
      expire: 2s
  vs_result_win:
    vs_alltargets_status:
      target: main
      action: remove
    vs_alltargets_win:
      target: main
      expire: 5s
      priority: 4000
  vs_result_lose:
    vs_alltargets_status:
      target: main
      action: remove
    vs_alltargets_lose:
      target: main
      expire: 5s
      priority: 4000

variable_player:
  mode_vs_alltargets_stopping: # clear VS active bit
    is_in_vs:
      int: 0
      action: set
  dec_opponent_health:
    opponent_health:
      int: current_player.opponent_health - 50
      action: set
  timer_player_health_drain_tick:
    player_health:
      int: current_player.player_health - 50
      action: set
  mode_vs_alltargets_started:
    opponent_health:
      int: 750
      action: set
    player_health:
      int: 750
      action: set
    is_in_vs:
      int: 1
      action: set
  vs_result_win:
    score: current_player.pts_vs_win

  vs_result_win{current_player.opponent == "CANADA"}:   # top left
    has_canada:
      action: set
      int: 1
  vs_result_win{current_player.opponent == "SCOTLAND"}: # top right
    has_scotland:
      action: set
      int: 1
  vs_result_win{current_player.opponent == "IRELAND"}:  # middle left
    has_ireland:
      action: set
      int: 1
  vs_result_win{current_player.opponent == "TOBAGO"}:   # middle right
    has_tobago:
      action: set
      int: 1
  vs_result_win{current_player.opponent == "GERMANY"}:  # bottom left
    has_germany:
      action: set
      int: 1

